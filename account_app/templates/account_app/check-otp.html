{% extends "base.html" %} 
{% load static %} 
{% block title %}تأیید کد OTP{% endblock %} 
{% block main %} 
<div class="container-fluid"> 
    <h2 class="section-title position-relative text-uppercase text-center mx-xl-5 mb-4"> 
        <span class="bg-secondary pr-3">تأیید کد</span> 
    </h2> 
    <div class="px-xl-5"> 
        <div class="mb-5 contact-us"> 
            <div class="contact-form bg-light p-30">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
                
                <form method="post" novalidate> 
                    {% csrf_token %} 
                    
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                     
                    <!-- فیلد کد --> 
                    <div class="form-group mb-3"> 
                        <label for="{{ form.code.id_for_label }}">{{ form.code.label }}</label>
                        {{ form.code }} 
                        {% if form.code.errors %} 
                            <div class="invalid-feedback d-block">{{ form.code.errors }}</div> 
                        {% endif %} 
                    </div> 
                    
                    <!-- توکن مخفی --> 
                    <input type="hidden" name="token" value="{{ token }}"> 
 
                    <div class="d-flex gap-2">
                        <button class="btn btn-success py-2 px-4" type="submit">تایید</button> 
                        <button type="button" id="resendBtn" class="btn py-2 px-4" style="background: transparent; color: #000; border: none; margin-left: 20px; font-size: 16px;" disabled onclick="resendOTP()">
                            <i class="fas fa-sync" style="color: #000; margin-left: 5px;"></i> ارسال مجدد کد (<span id="timer">60</span>)
                        </button>
                    </div>
                </form> 
            </div> 
        </div> 
    </div> 
</div> 

<script> 
// دک ددجم لاسرا همکد یارب رمیات 
let timeLeft = 60; 
const resendBtn = document.getElementById('resendBtn'); 
const timerSpan = document.getElementById('timer'); 
 
function startTimer() { 
    resendBtn.disabled = true; 
    timeLeft = 60; 
     
    const countdown = setInterval(() => { 
        timeLeft--; 
        timerSpan.textContent = timeLeft; 
         
        if (timeLeft <= 0) { 
            clearInterval(countdown); 
            resendBtn.disabled = false; 
            timerSpan.textContent = 'ارسال'; 
            resendBtn.innerHTML = 'ارسال مجدد کد'; 
        } else { 
            resendBtn.innerHTML = `ارسال مجدد کد (<span id="timer">${timeLeft}</span>)`; 
        } 
    }, 1000); 
} 
 
function resendOTP() { 
    const token = document.querySelector('input[name="token"]').value; 
    window.location.href = `{% url 'account_app:resend-otp' %}?token=${token}`; 
} 

document.addEventListener('DOMContentLoaded', startTimer); 
</script> 
{% endblock %} 